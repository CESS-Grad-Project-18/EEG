/*
* Configuration of module: CanIf
*
* Created by:   parai          
* Copyright:    (C)parai@foxmail.com  
*
* Configured for (MCU):    MinGW ...
*
* Module vendor:           ArcCore
* Generator version:       2.0.34
*
* Generated by easySAR Studio (https://github.com/parai/OpenSAR)
*/

#include "CanIf.h"
//#if defined(USE_CANTP)
#include "CanTp.h"
#include "CanTp_Cbk.h"
//#endif
#if defined(USE_J1939TP)
#include "J1939Tp.h"
#include "J1939Tp_Cbk.h"
#endif
//#if defined(USE_PDUR)
#include "PduR.h"
//#endif
#if defined(USE_CANNM)
#include "CanNm_Cbk.h"
#endif
//#include <stdlib.h>

// Imported structs from Can_PBcfg.c
extern const Can_ControllerConfigType Can_ControllerCfgData[];
extern const Can_ConfigSetType Can_ConfigSetData;

// Contains the mapping from CanIf-specific Channels to Can Controllers
const CanControllerIdType CanIf_Arc_ChannelToControllerMap[CANIF_CHANNEL_CNT] = {
	CAN_CTRL_0                      ,/* CANIF_CHL_LS                     */
	CAN_CTRL_2                      ,/* CANIF_CHL_HS                     */

};

const uint8 CanIf_Arc_ChannelDefaultConfIndex[CANIF_CHANNEL_CNT] = {
	CANIF_CHL_LS_CONFIG_0,
	CANIF_CHL_HS_CONFIG_0,

};

// Container that gets slamed into CanIf_InitController()
// Inits ALL controllers
// Multiplicity 1..*
const CanIf_ControllerConfigType CanIfControllerConfig[] = {

    {
        .WakeupSupport = CANIF_WAKEUP_SUPPORT_NO_WAKEUP,
        .CanIfControllerIdRef = CANIF_CHL_LS,
        .CanIfDriverNameRef = "FLEXCAN",  // Not used
        .CanIfInitControllerRef = &Can_ControllerCfgData[INDEX_OF_CAN_CTRL_0],
    },

    {
        .WakeupSupport = CANIF_WAKEUP_SUPPORT_NO_WAKEUP,
        .CanIfControllerIdRef = CANIF_CHL_HS,
        .CanIfDriverNameRef = "FLEXCAN",  // Not used
        .CanIfInitControllerRef = &Can_ControllerCfgData[INDEX_OF_CAN_CTRL_2],
    },

};


// Function callbacks for higher layers
const CanIf_DispatchConfigType CanIfDispatchConfig =
{
    .CanIfBusOffNotification = NULL,
    .CanIfWakeUpNotification = NULL,        // Not used
    .CanIfWakeupValidNotification = NULL,   // Not used
    .CanIfErrorNotificaton = NULL,
};
const CanIf_HthConfigType CanIfHthConfigData_CANIF_CHL_LS[]=
{

    {
        .CanIfHthType = CAN_ARC_HANDLE_TYPE_BASIC, // TODO
        .CanIfCanControllerIdRef = CANIF_CHL_LS,
        .CanIfHthIdSymRef = Can0Hth,
        .CanIf_Arc_EOL = TRUE
    },
};

const CanIf_HthConfigType CanIfHthConfigData_CANIF_CHL_HS[]=
{

    {
        .CanIfHthType = CAN_ARC_HANDLE_TYPE_BASIC, // TODO
        .CanIfCanControllerIdRef = CANIF_CHL_HS,
        .CanIfHthIdSymRef = Can2Hth,
        .CanIf_Arc_EOL = TRUE
    },
};

const CanIf_HrhConfigType CanIfHrhConfigData_CANIF_CHL_LS[]=
{

    {
        .CanIfHrhType = CAN_ARC_HANDLE_TYPE_BASIC, // TODO: not used by CanIf now.
        .CanIfSoftwareFilterHrh = TRUE, // Must Be True
        .CanIfCanControllerHrhIdRef = CANIF_CHL_LS,
        .CanIfHrhIdSymRef = Can0Hrh,
        .CanIfHrhRangeConfig = NULL,
        .CanIf_Arc_EOL = TRUE
    },
};

const CanIf_HrhConfigType CanIfHrhConfigData_CANIF_CHL_HS[]=
{

    {
        .CanIfHrhType = CAN_ARC_HANDLE_TYPE_BASIC, // TODO: not used by CanIf now.
        .CanIfSoftwareFilterHrh = TRUE, // Must Be True
        .CanIfCanControllerHrhIdRef = CANIF_CHL_HS,
        .CanIfHrhIdSymRef = Can2Hrh,
        .CanIfHrhRangeConfig = NULL,
        .CanIf_Arc_EOL = TRUE
    },
};

const CanIf_InitHohConfigType CanIfHohConfigData[] =
{

    {
        .CanConfigSet = &Can_ConfigSetData,
        .CanIfHrhConfig = CanIfHrhConfigData_CANIF_CHL_LS,
        .CanIfHthConfig = CanIfHthConfigData_CANIF_CHL_LS,
        .CanIf_Arc_EOL = FALSE
    },

    {
        .CanConfigSet = &Can_ConfigSetData,
        .CanIfHrhConfig = CanIfHrhConfigData_CANIF_CHL_HS,
        .CanIfHthConfig = CanIfHthConfigData_CANIF_CHL_HS,
        .CanIf_Arc_EOL = TRUE
    },
};


const CanIf_TxPduConfigType CanIfTxPduConfigData[] = 
{
    
    {
        .CanIfTxPduId = CANTP_ID_TxDiagP2P,
        .CanIfCanTxPduIdCanId = 0x732, 
        .CanIfCanTxPduIdDlc = 8,
        .CanIfCanTxPduType = CANIF_PDU_TYPE_STATIC,
#if ( CANIF_READTXPDU_NOTIFY_STATUS_API == STD_ON )
        .CanIfReadTxPduNotifyStatus = TRUE,
#endif
        .CanIfTxPduIdCanIdType = CANIF_CAN_ID_TYPE_11,
        .CanIfUserTxConfirmation = CanTp_TxConfirmation,
        .CanIfCanTxPduHthRef = &CanIfHthConfigData_CANIF_CHL_LS[0],
        .PduIdRef = NULL
    },

    {
        .CanIfTxPduId = CANTP_ID_TxDiagP2A,
        .CanIfCanTxPduIdCanId = 0x742, 
        .CanIfCanTxPduIdDlc = 8,
        .CanIfCanTxPduType = CANIF_PDU_TYPE_STATIC,
#if ( CANIF_READTXPDU_NOTIFY_STATUS_API == STD_ON )
        .CanIfReadTxPduNotifyStatus = TRUE,
#endif
        .CanIfTxPduIdCanIdType = CANIF_CAN_ID_TYPE_11,
        .CanIfUserTxConfirmation = CanTp_TxConfirmation,
        .CanIfCanTxPduHthRef = &CanIfHthConfigData_CANIF_CHL_LS[0],
        .PduIdRef = NULL
    },

    {
        .CanIfTxPduId = CANNM_ID_LS_NM_TX,
        .CanIfCanTxPduIdCanId = 0x401, 
        .CanIfCanTxPduIdDlc = 8,
        .CanIfCanTxPduType = CANIF_PDU_TYPE_STATIC,
#if ( CANIF_READTXPDU_NOTIFY_STATUS_API == STD_ON )
        .CanIfReadTxPduNotifyStatus = TRUE,
#endif
        .CanIfTxPduIdCanIdType = CANIF_CAN_ID_TYPE_11,
        .CanIfUserTxConfirmation = CanNm_TxConfirmation,
        .CanIfCanTxPduHthRef = &CanIfHthConfigData_CANIF_CHL_LS[0],
        .PduIdRef = NULL
    },

    {
        .CanIfTxPduId = PDUR_ID2_TxMsgTime,
        .CanIfCanTxPduIdCanId = 0x101, 
        .CanIfCanTxPduIdDlc = 8,
        .CanIfCanTxPduType = CANIF_PDU_TYPE_STATIC,
#if ( CANIF_READTXPDU_NOTIFY_STATUS_API == STD_ON )
        .CanIfReadTxPduNotifyStatus = TRUE,
#endif
        .CanIfTxPduIdCanIdType = CANIF_CAN_ID_TYPE_11,
        .CanIfUserTxConfirmation = PduR_CanIfTxConfirmation,
        .CanIfCanTxPduHthRef = &CanIfHthConfigData_CANIF_CHL_HS[0],
        .PduIdRef = NULL
    },

    {
        .CanIfTxPduId = CANNM_ID_HS_NM_TX,
        .CanIfCanTxPduIdCanId = 0x402, 
        .CanIfCanTxPduIdDlc = 8,
        .CanIfCanTxPduType = CANIF_PDU_TYPE_STATIC,
#if ( CANIF_READTXPDU_NOTIFY_STATUS_API == STD_ON )
        .CanIfReadTxPduNotifyStatus = TRUE,
#endif
        .CanIfTxPduIdCanIdType = CANIF_CAN_ID_TYPE_11,
        .CanIfUserTxConfirmation = CanNm_TxConfirmation,
        .CanIfCanTxPduHthRef = &CanIfHthConfigData_CANIF_CHL_HS[0],
        .PduIdRef = NULL
    },

};


const CanIf_RxPduConfigType CanIfRxPduConfigData[] = 
{
    
    {
        .CanIfCanRxPduId = CANTP_ID_RxDiagP2P,
        .CanIfCanRxPduCanId = 0x731,
        .CanIfCanRxPduDlc = 8,
#if ( CANIF_CANPDUID_READDATA_API == STD_ON )
        .CanIfReadRxPduData = TRUE,
#endif
#if ( CANIF_READTXPDU_NOTIFY_STATUS_API == STD_ON )
        .CanIfReadRxPduNotifyStatus = TRUE,
#endif
        .CanIfRxPduIdCanIdType = CANIF_CAN_ID_TYPE_11,
        .CanIfRxUserType = CANIF_USER_TYPE_CAN_TP,
        .CanIfUserRxIndication = NULL,
        .CanIfCanRxPduHrhRef = &CanIfHrhConfigData_CANIF_CHL_LS[0],
        .PduIdRef = NULL,
        .CanIfSoftwareFilterType = CANIF_SOFTFILTER_TYPE_MASK,
        .CanIfCanRxPduCanIdMask = 0xFFF
    },

    {
        .CanIfCanRxPduId = CANTP_ID_RxDiagP2A,
        .CanIfCanRxPduCanId = 0x741,
        .CanIfCanRxPduDlc = 8,
#if ( CANIF_CANPDUID_READDATA_API == STD_ON )
        .CanIfReadRxPduData = TRUE,
#endif
#if ( CANIF_READTXPDU_NOTIFY_STATUS_API == STD_ON )
        .CanIfReadRxPduNotifyStatus = TRUE,
#endif
        .CanIfRxPduIdCanIdType = CANIF_CAN_ID_TYPE_11,
        .CanIfRxUserType = CANIF_USER_TYPE_CAN_TP,
        .CanIfUserRxIndication = NULL,
        .CanIfCanRxPduHrhRef = &CanIfHrhConfigData_CANIF_CHL_LS[0],
        .PduIdRef = NULL,
        .CanIfSoftwareFilterType = CANIF_SOFTFILTER_TYPE_MASK,
        .CanIfCanRxPduCanIdMask = 0xFFF
    },

    {
        .CanIfCanRxPduId = PDUR_ID_RxMsgAbsInfo,
        .CanIfCanRxPduCanId = 0x102,
        .CanIfCanRxPduDlc = 8,
#if ( CANIF_CANPDUID_READDATA_API == STD_ON )
        .CanIfReadRxPduData = TRUE,
#endif
#if ( CANIF_READTXPDU_NOTIFY_STATUS_API == STD_ON )
        .CanIfReadRxPduNotifyStatus = TRUE,
#endif
        .CanIfRxPduIdCanIdType = CANIF_CAN_ID_TYPE_11,
        .CanIfRxUserType = CANIF_USER_TYPE_CAN_PDUR,
        .CanIfUserRxIndication = NULL,
        .CanIfCanRxPduHrhRef = &CanIfHrhConfigData_CANIF_CHL_HS[0],
        .PduIdRef = NULL,
        .CanIfSoftwareFilterType = CANIF_SOFTFILTER_TYPE_MASK,
        .CanIfCanRxPduCanIdMask = 0xFFFF
    },

};

// This container contains the init parameters of the CAN
// Multiplicity 1..*
const CanIf_InitConfigType CanIfInitConfig =
{
    .CanIfConfigSet = 0, // Not used
    .CanIfNumberOfCanRxPduIds = sizeof(CanIfRxPduConfigData)/sizeof(CanIf_RxPduConfigType),
    .CanIfNumberOfCanTXPduIds = sizeof(CanIfTxPduConfigData)/sizeof(CanIf_TxPduConfigType),
    .CanIfNumberOfDynamicCanTXPduIds = 0, // Not used
    // Containers
    .CanIfHohConfigPtr = CanIfHohConfigData,
    .CanIfRxPduConfigPtr = CanIfRxPduConfigData,
    .CanIfTxPduConfigPtr = CanIfTxPduConfigData,
};
// This container includes all necessary configuration sub-containers
// according the CAN Interface configuration structure
const CanIf_ConfigType CanIf_Config =
{
    .ControllerConfig = CanIfControllerConfig,
    .DispatchConfig = &CanIfDispatchConfig,
    .InitConfig = &CanIfInitConfig,
    .TransceiverConfig = NULL, // Not used
    .Arc_ChannelToControllerMap = CanIf_Arc_ChannelToControllerMap,
    .Arc_ChannelDefaultConfIndex = CanIf_Arc_ChannelDefaultConfIndex,
};
    